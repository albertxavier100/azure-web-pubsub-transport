mergeInto(LibraryManager.library, {
    options: {},
    negotiation: {},
    client: null,
    AddWebPubSubScript: function () {
        const e = '/*! For license information please see output.js.LICENSE.txt */\n(()=>{var t={742:(t,e)=>{"use strict";e.byteLength=function(t){var e=c(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,n,i=c(t),s=i[0],a=i[1],u=new o(function(t,e,n){return 3*(e+n)/4-n}(0,s,a)),f=0,h=a>0?s-4:s;for(n=0;n<h;n+=4)e=r[t.charCodeAt(n)]<<18|r[t.charCodeAt(n+1)]<<12|r[t.charCodeAt(n+2)]<<6|r[t.charCodeAt(n+3)],u[f++]=e>>16&255,u[f++]=e>>8&255,u[f++]=255&e;return 2===a&&(e=r[t.charCodeAt(n)]<<2|r[t.charCodeAt(n+1)]>>4,u[f++]=255&e),1===a&&(e=r[t.charCodeAt(n)]<<10|r[t.charCodeAt(n+1)]<<4|r[t.charCodeAt(n+2)]>>2,u[f++]=e>>8&255,u[f++]=255&e),u},e.fromByteArray=function(t){for(var e,r=t.length,o=r%3,i=[],s=16383,a=0,c=r-o;a<c;a+=s)i.push(u(t,a,a+s>c?c:a+s));return 1===o?(e=t[r-1],i.push(n[e>>2]+n[e<<4&63]+"==")):2===o&&(e=(t[r-2]<<8)+t[r-1],i.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"=")),i.join("")};for(var n=[],r=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=i.length;s<a;++s)n[s]=i[s],r[i.charCodeAt(s)]=s;function c(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function u(t,e,r){for(var o,i,s=[],a=e;a<r;a+=3)o=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(255&t[a+2]),s.push(n[(i=o)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},764:(t,e,n)=>{"use strict";const r=n(742),o=n(645),i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.lW=c,e.h2=50;const s=2147483647;function a(t){if(t>s)throw new RangeError(\'The value "\'+t+\'" is invalid for option "size"\');const e=new Uint8Array(t);return Object.setPrototypeOf(e,c.prototype),e}function c(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new TypeError(\'The "string" argument must be of type string. Received type number\');return h(t)}return u(t,e,n)}function u(t,e,n){if("string"==typeof t)return function(t,e){if("string"==typeof e&&""!==e||(e="utf8"),!c.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const n=0|y(t,e);let r=a(n);const o=r.write(t,e);return o!==n&&(r=r.slice(0,o)),r}(t,e);if(ArrayBuffer.isView(t))return function(t){if(Z(t,Uint8Array)){const e=new Uint8Array(t);return p(e.buffer,e.byteOffset,e.byteLength)}return l(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(Z(t,ArrayBuffer)||t&&Z(t.buffer,ArrayBuffer))return p(t,e,n);if("undefined"!=typeof SharedArrayBuffer&&(Z(t,SharedArrayBuffer)||t&&Z(t.buffer,SharedArrayBuffer)))return p(t,e,n);if("number"==typeof t)throw new TypeError(\'The "value" argument must not be of type number. Received type number\');const r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return c.from(r,e,n);const o=function(t){if(c.isBuffer(t)){const e=0|d(t.length),n=a(e);return 0===n.length||t.copy(n,0,0,e),n}return void 0!==t.length?"number"!=typeof t.length||K(t.length)?a(0):l(t):"Buffer"===t.type&&Array.isArray(t.data)?l(t.data):void 0}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return c.from(t[Symbol.toPrimitive]("string"),e,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function f(t){if("number"!=typeof t)throw new TypeError(\'"size" argument must be of type number\');if(t<0)throw new RangeError(\'The value "\'+t+\'" is invalid for option "size"\')}function h(t){return f(t),a(t<0?0:0|d(t))}function l(t){const e=t.length<0?0:0|d(t.length),n=a(e);for(let r=0;r<e;r+=1)n[r]=255&t[r];return n}function p(t,e,n){if(e<0||t.byteLength<e)throw new RangeError(\'"offset" is outside of buffer bounds\');if(t.byteLength<e+(n||0))throw new RangeError(\'"length" is outside of buffer bounds\');let r;return r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n),Object.setPrototypeOf(r,c.prototype),r}function d(t){if(t>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|t}function y(t,e){if(c.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||Z(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError(\'The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type \'+typeof t);const n=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let o=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return J(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return V(t).length;default:if(o)return r?-1:J(t).length;e=(""+e).toLowerCase(),o=!0}}function g(t,e,n){let r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return C(this,e,n);case"utf8":case"utf-8":return k(this,e,n);case"ascii":return B(this,e,n);case"latin1":case"binary":return S(this,e,n);case"base64":return A(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function w(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function b(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),K(n=+n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof e&&(e=c.from(e,r)),c.isBuffer(e))return 0===e.length?-1:_(t,e,n,r,o);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):_(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function _(t,e,n,r,o){let i,s=1,a=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(o){let r=-1;for(i=n;i<a;i++)if(u(t,i)===u(e,-1===r?0:i-r)){if(-1===r&&(r=i),i-r+1===c)return r*s}else-1!==r&&(i-=i-r),r=-1}else for(n+c>a&&(n=a-c),i=n;i>=0;i--){let n=!0;for(let r=0;r<c;r++)if(u(t,i+r)!==u(e,r)){n=!1;break}if(n)return i}return-1}function m(t,e,n,r){n=Number(n)||0;const o=t.length-n;r?(r=Number(r))>o&&(r=o):r=o;const i=e.length;let s;for(r>i/2&&(r=i/2),s=0;s<r;++s){const r=parseInt(e.substr(2*s,2),16);if(K(r))return s;t[n+s]=r}return s}function v(t,e,n,r){return Y(J(e,t.length-n),t,n,r)}function E(t,e,n,r){return Y(function(t){const e=[];for(let n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function I(t,e,n,r){return Y(V(e),t,n,r)}function R(t,e,n,r){return Y(function(t,e){let n,r,o;const i=[];for(let s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(e,t.length-n),t,n,r)}function A(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function k(t,e,n){n=Math.min(t.length,n);const r=[];let o=e;for(;o<n;){const e=t[o];let i=null,s=e>239?4:e>223?3:e>191?2:1;if(o+s<=n){let n,r,a,c;switch(s){case 1:e<128&&(i=e);break;case 2:n=t[o+1],128==(192&n)&&(c=(31&e)<<6|63&n,c>127&&(i=c));break;case 3:n=t[o+1],r=t[o+2],128==(192&n)&&128==(192&r)&&(c=(15&e)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:n=t[o+1],r=t[o+2],a=t[o+3],128==(192&n)&&128==(192&r)&&128==(192&a)&&(c=(15&e)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,s=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i),o+=s}return function(t){const e=t.length;if(e<=O)return String.fromCharCode.apply(String,t);let n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=O));return n}(r)}c.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),c.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),c.poolSize=8192,c.from=function(t,e,n){return u(t,e,n)},Object.setPrototypeOf(c.prototype,Uint8Array.prototype),Object.setPrototypeOf(c,Uint8Array),c.alloc=function(t,e,n){return function(t,e,n){return f(t),t<=0?a(t):void 0!==e?"string"==typeof n?a(t).fill(e,n):a(t).fill(e):a(t)}(t,e,n)},c.allocUnsafe=function(t){return h(t)},c.allocUnsafeSlow=function(t){return h(t)},c.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==c.prototype},c.compare=function(t,e){if(Z(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),Z(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError(\'The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array\');if(t===e)return 0;let n=t.length,r=e.length;for(let o=0,i=Math.min(n,r);o<i;++o)if(t[o]!==e[o]){n=t[o],r=e[o];break}return n<r?-1:r<n?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!Array.isArray(t))throw new TypeError(\'"list" argument must be an Array of Buffers\');if(0===t.length)return c.alloc(0);let n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;const r=c.allocUnsafe(e);let o=0;for(n=0;n<t.length;++n){let e=t[n];if(Z(e,Uint8Array))o+e.length>r.length?(c.isBuffer(e)||(e=c.from(e)),e.copy(r,o)):Uint8Array.prototype.set.call(r,e,o);else{if(!c.isBuffer(e))throw new TypeError(\'"list" argument must be an Array of Buffers\');e.copy(r,o)}o+=e.length}return r},c.byteLength=y,c.prototype._isBuffer=!0,c.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)w(this,e,e+1);return this},c.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)w(this,e,e+3),w(this,e+1,e+2);return this},c.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)w(this,e,e+7),w(this,e+1,e+6),w(this,e+2,e+5),w(this,e+3,e+4);return this},c.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?k(this,0,t):g.apply(this,arguments)},c.prototype.toLocaleString=c.prototype.toString,c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){let t="";const n=e.h2;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},i&&(c.prototype[i]=c.prototype.inspect),c.prototype.compare=function(t,e,n,r,o){if(Z(t,Uint8Array)&&(t=c.from(t,t.offset,t.byteLength)),!c.isBuffer(t))throw new TypeError(\'The "target" argument must be one of type Buffer or Uint8Array. Received type \'+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),e<0||n>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&e>=n)return 0;if(r>=o)return-1;if(e>=n)return 1;if(this===t)return 0;let i=(o>>>=0)-(r>>>=0),s=(n>>>=0)-(e>>>=0);const a=Math.min(i,s),u=this.slice(r,o),f=t.slice(e,n);for(let t=0;t<a;++t)if(u[t]!==f[t]){i=u[t],s=f[t];break}return i<s?-1:s<i?1:0},c.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},c.prototype.indexOf=function(t,e,n){return b(this,t,e,n,!0)},c.prototype.lastIndexOf=function(t,e,n){return b(this,t,e,n,!1)},c.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let i=!1;for(;;)switch(r){case"hex":return m(this,t,e,n);case"utf8":case"utf-8":return v(this,t,e,n);case"ascii":case"latin1":case"binary":return E(this,t,e,n);case"base64":return I(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,t,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const O=4096;function B(t,e,n){let r="";n=Math.min(t.length,n);for(let o=e;o<n;++o)r+=String.fromCharCode(127&t[o]);return r}function S(t,e,n){let r="";n=Math.min(t.length,n);for(let o=e;o<n;++o)r+=String.fromCharCode(t[o]);return r}function C(t,e,n){const r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);let o="";for(let r=e;r<n;++r)o+=X[t[r]];return o}function M(t,e,n){const r=t.slice(e,n);let o="";for(let t=0;t<r.length-1;t+=2)o+=String.fromCharCode(r[t]+256*r[t+1]);return o}function T(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,n,r,o,i){if(!c.isBuffer(t))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(e>o||e<i)throw new RangeError(\'"value" argument is out of bounds\');if(n+r>t.length)throw new RangeError("Index out of range")}function U(t,e,n,r,o){F(e,r,o,t,n,7);let i=Number(e&BigInt(4294967295));t[n++]=i,i>>=8,t[n++]=i,i>>=8,t[n++]=i,i>>=8,t[n++]=i;let s=Number(e>>BigInt(32)&BigInt(4294967295));return t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s,n}function x(t,e,n,r,o){F(e,r,o,t,n,7);let i=Number(e&BigInt(4294967295));t[n+7]=i,i>>=8,t[n+6]=i,i>>=8,t[n+5]=i,i>>=8,t[n+4]=i;let s=Number(e>>BigInt(32)&BigInt(4294967295));return t[n+3]=s,s>>=8,t[n+2]=s,s>>=8,t[n+1]=s,s>>=8,t[n]=s,n+8}function j(t,e,n,r,o,i){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function D(t,e,n,r,i){return e=+e,n>>>=0,i||j(t,0,n,4),o.write(t,e,n,r,23,4),n+4}function $(t,e,n,r,i){return e=+e,n>>>=0,i||j(t,0,n,8),o.write(t,e,n,r,52,8),n+8}c.prototype.slice=function(t,e){const n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);const r=this.subarray(t,e);return Object.setPrototypeOf(r,c.prototype),r},c.prototype.readUintLE=c.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||T(t,e,this.length);let r=this[t],o=1,i=0;for(;++i<e&&(o*=256);)r+=this[t+i]*o;return r},c.prototype.readUintBE=c.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||T(t,e,this.length);let r=this[t+--e],o=1;for(;e>0&&(o*=256);)r+=this[t+--e]*o;return r},c.prototype.readUint8=c.prototype.readUInt8=function(t,e){return t>>>=0,e||T(t,1,this.length),this[t]},c.prototype.readUint16LE=c.prototype.readUInt16LE=function(t,e){return t>>>=0,e||T(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUint16BE=c.prototype.readUInt16BE=function(t,e){return t>>>=0,e||T(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUint32LE=c.prototype.readUInt32LE=function(t,e){return t>>>=0,e||T(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUint32BE=c.prototype.readUInt32BE=function(t,e){return t>>>=0,e||T(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readBigUInt64LE=H((function(t){q(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||W(t,this.length-8);const r=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,o=this[++t]+256*this[++t]+65536*this[++t]+n*2**24;return BigInt(r)+(BigInt(o)<<BigInt(32))})),c.prototype.readBigUInt64BE=H((function(t){q(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||W(t,this.length-8);const r=e*2**24+65536*this[++t]+256*this[++t]+this[++t],o=this[++t]*2**24+65536*this[++t]+256*this[++t]+n;return(BigInt(r)<<BigInt(32))+BigInt(o)})),c.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||T(t,e,this.length);let r=this[t],o=1,i=0;for(;++i<e&&(o*=256);)r+=this[t+i]*o;return o*=128,r>=o&&(r-=Math.pow(2,8*e)),r},c.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||T(t,e,this.length);let r=e,o=1,i=this[t+--r];for(;r>0&&(o*=256);)i+=this[t+--r]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*e)),i},c.prototype.readInt8=function(t,e){return t>>>=0,e||T(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){t>>>=0,e||T(t,2,this.length);const n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(t,e){t>>>=0,e||T(t,2,this.length);const n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(t,e){return t>>>=0,e||T(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return t>>>=0,e||T(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readBigInt64LE=H((function(t){q(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||W(t,this.length-8);const r=this[t+4]+256*this[t+5]+65536*this[t+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),c.prototype.readBigInt64BE=H((function(t){q(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||W(t,this.length-8);const r=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(r)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+n)})),c.prototype.readFloatLE=function(t,e){return t>>>=0,e||T(t,4,this.length),o.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return t>>>=0,e||T(t,4,this.length),o.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return t>>>=0,e||T(t,8,this.length),o.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return t>>>=0,e||T(t,8,this.length),o.read(this,t,!1,52,8)},c.prototype.writeUintLE=c.prototype.writeUIntLE=function(t,e,n,r){t=+t,e>>>=0,n>>>=0,r||L(this,t,e,n,Math.pow(2,8*n)-1,0);let o=1,i=0;for(this[e]=255&t;++i<n&&(o*=256);)this[e+i]=t/o&255;return e+n},c.prototype.writeUintBE=c.prototype.writeUIntBE=function(t,e,n,r){t=+t,e>>>=0,n>>>=0,r||L(this,t,e,n,Math.pow(2,8*n)-1,0);let o=n-1,i=1;for(this[e+o]=255&t;--o>=0&&(i*=256);)this[e+o]=t/i&255;return e+n},c.prototype.writeUint8=c.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||L(this,t,e,1,255,0),this[e]=255&t,e+1},c.prototype.writeUint16LE=c.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||L(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},c.prototype.writeUint16BE=c.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||L(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},c.prototype.writeUint32LE=c.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||L(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},c.prototype.writeUint32BE=c.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||L(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},c.prototype.writeBigUInt64LE=H((function(t,e=0){return U(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeBigUInt64BE=H((function(t,e=0){return x(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),c.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);L(this,t,e,n,r-1,-r)}let o=0,i=1,s=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/i>>0)-s&255;return e+n},c.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);L(this,t,e,n,r-1,-r)}let o=n-1,i=1,s=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/i>>0)-s&255;return e+n},c.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||L(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||L(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},c.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||L(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},c.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||L(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},c.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},c.prototype.writeBigInt64LE=H((function(t,e=0){return U(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeBigInt64BE=H((function(t,e=0){return x(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),c.prototype.writeFloatLE=function(t,e,n){return D(this,t,e,!0,n)},c.prototype.writeFloatBE=function(t,e,n){return D(this,t,e,!1,n)},c.prototype.writeDoubleLE=function(t,e,n){return $(this,t,e,!0,n)},c.prototype.writeDoubleBE=function(t,e,n){return $(this,t,e,!1,n)},c.prototype.copy=function(t,e,n,r){if(!c.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);const o=r-n;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,n,r):Uint8Array.prototype.set.call(t,this.subarray(n,r),e),o},c.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){const e=t.charCodeAt(0);("utf8"===r&&e<128||"latin1"===r)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;let o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{const i=c.isBuffer(t)?t:c.from(t,r),s=i.length;if(0===s)throw new TypeError(\'The value "\'+t+\'" is invalid for argument "value"\');for(o=0;o<n-e;++o)this[o+e]=i[o%s]}return this};const P={};function G(t,e,n){P[t]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function N(t){let e="",n=t.length;const r="-"===t[0]?1:0;for(;n>=r+4;n-=3)e=`_${t.slice(n-3,n)}${e}`;return`${t.slice(0,n)}${e}`}function F(t,e,n,r,o,i){if(t>n||t<e){const r="bigint"==typeof e?"n":"";let o;throw o=i>3?0===e||e===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(i+1)}${r}`:`>= -(2${r} ** ${8*(i+1)-1}${r}) and < 2 ** ${8*(i+1)-1}${r}`:`>= ${e}${r} and <= ${n}${r}`,new P.ERR_OUT_OF_RANGE("value",o,t)}!function(t,e,n){q(e,"offset"),void 0!==t[e]&&void 0!==t[e+n]||W(e,t.length-(n+1))}(r,o,i)}function q(t,e){if("number"!=typeof t)throw new P.ERR_INVALID_ARG_TYPE(e,"number",t)}function W(t,e,n){if(Math.floor(t)!==t)throw q(t,n),new P.ERR_OUT_OF_RANGE(n||"offset","an integer",t);if(e<0)throw new P.ERR_BUFFER_OUT_OF_BOUNDS;throw new P.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${e}`,t)}G("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),G("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),G("ERR_OUT_OF_RANGE",(function(t,e,n){let r=`The value of "${t}" is out of range.`,o=n;return Number.isInteger(n)&&Math.abs(n)>2**32?o=N(String(n)):"bigint"==typeof n&&(o=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(o=N(o)),o+="n"),r+=` It must be ${e}. Received ${o}`,r}),RangeError);const z=/[^+/0-9A-Za-z-_]/g;function J(t,e){let n;e=e||1/0;const r=t.length;let o=null;const i=[];for(let s=0;s<r;++s){if(n=t.charCodeAt(s),n>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function V(t){return r.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(z,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Y(t,e,n,r){let o;for(o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}function Z(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function K(t){return t!=t}const X=function(){const t="0123456789abcdef",e=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let o=0;o<16;++o)e[r+o]=t[n]+t[o]}return e}();function H(t){return"undefined"==typeof BigInt?Q:t}function Q(){throw new Error("BigInt not supported")}},187:t=>{"use strict";var e,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var o=Number.isNaN||function(t){return t!=t};function i(){i.init.call(this)}t.exports=i,t.exports.once=function(t,e){return new Promise((function(n,r){function o(n){t.removeListener(e,i),r(n)}function i(){"function"==typeof t.removeListener&&t.removeListener("error",o),n([].slice.call(arguments))}y(t,e,i,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&y(t,"error",e,{once:!0})}(t,o)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(t){if("function"!=typeof t)throw new TypeError(\'The "listener" argument must be of type Function. Received type \'+typeof t)}function c(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function u(t,e,n,r){var o,i,s,u;if(a(n),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),s=i[e]),void 0===s)s=i[e]=n,++t._eventsCount;else if("function"==typeof s?s=i[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=c(t))>0&&s.length>o&&!s.warned){s.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=t,f.type=e,f.count=s.length,u=f,console&&console.warn&&console.warn(u)}return t}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=f.bind(r);return o.listener=n,r.wrapFn=o,o}function l(t,e,n){var r=t._events;if(void 0===r)return[];var o=r[e];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(o):d(o,o.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function d(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function y(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError(\'The "emitter" argument must be of type EventEmitter. Received type \'+typeof t);t.addEventListener(e,(function o(i){r.once&&t.removeEventListener(e,o),n(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError(\'The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received \'+t+".");s=t}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||o(t))throw new RangeError(\'The value of "n" is out of range. It must be a non-negative number. Received \'+t+".");return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var o="error"===t,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[t];if(void 0===c)return!1;if("function"==typeof c)r(c,this,e);else{var u=c.length,f=d(c,u);for(n=0;n<u;++n)r(f[n],this,e)}return!0},i.prototype.addListener=function(t,e){return u(this,t,e,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(t,e){return u(this,t,e,!0)},i.prototype.once=function(t,e){return a(e),this.on(t,h(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,h(this,t,e)),this},i.prototype.removeListener=function(t,e){var n,r,o,i,s;if(a(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===e||n[i].listener===e){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,o),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,s||e)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},i.prototype.listeners=function(t){return l(this,t,!0)},i.prototype.rawListeners=function(t){return l(this,t,!1)},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},i.prototype.listenerCount=p,i.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},645:(t,e)=>{e.read=function(t,e,n,r,o){var i,s,a=8*o-r-1,c=(1<<a)-1,u=c>>1,f=-7,h=n?o-1:0,l=n?-1:1,p=t[e+h];for(h+=l,i=p&(1<<-f)-1,p>>=-f,f+=a;f>0;i=256*i+t[e+h],h+=l,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=r;f>0;s=256*s+t[e+h],h+=l,f-=8);if(0===i)i=1-u;else{if(i===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),i-=u}return(p?-1:1)*s*Math.pow(2,i-r)},e.write=function(t,e,n,r,o,i){var s,a,c,u=8*i-o-1,f=(1<<u)-1,h=f>>1,l=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,d=r?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=f):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),(e+=s+h>=1?l/c:l*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=f?(a=0,s=f):s+h>=1?(a=(e*c-1)*Math.pow(2,o),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,o),s=0));o>=8;t[n+p]=255&a,p+=d,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;t[n+p]=255&s,p+=d,s/=256,u-=8);t[n+p-d]|=128*y}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=new WeakMap,e=new WeakMap;class r{constructor(){this.onabort=null,t.set(this,[]),e.set(this,!1)}get aborted(){if(!e.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");return e.get(this)}static get none(){return new r}addEventListener(e,n){if(!t.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");t.get(this).push(n)}removeEventListener(e,n){if(!t.has(this))throw new TypeError("Expected `this` to be an instance of AbortSignal.");const r=t.get(this),o=r.indexOf(n);o>-1&&r.splice(o,1)}dispatchEvent(t){throw new Error("This is a stub dispatchEvent implementation that should not be used.  It only exists for type-checking purposes.")}}function o(n){if(n.aborted)return;n.onabort&&n.onabort.call(n);const r=t.get(n);r&&r.slice().forEach((t=>{t.call(n,{type:"abort"})})),e.set(n,!0)}class i extends Error{constructor(t){super(t),this.name="AbortError"}}class s{constructor(t){if(this._signal=new r,t){Array.isArray(t)||(t=arguments);for(const e of t)e.aborted?this.abort():e.addEventListener("abort",(()=>{this.abort()}))}}get signal(){return this._signal}abort(){o(this._signal)}static timeout(t){const e=new r,n=setTimeout(o,t,e);return"function"==typeof n.unref&&n.unref(),e}}const a="The delay was aborted.";function c(t,e){let n;const{abortSignal:r,abortErrorMsg:o}=null!=e?e:{};return function(e,r){const{cleanupBeforeAbort:o,abortSignal:s,abortErrorMsg:a}=null!=r?r:{};return new Promise(((e,r)=>{function c(){r(new i(null!=a?a:"The operation was aborted."))}function u(){null==s||s.removeEventListener("abort",f)}function f(){null==o||o(),u(),c()}if(null==s?void 0:s.aborted)return c();try{(e=>{n=setTimeout(e,t)})((t=>{u(),e(t)}))}catch(t){r(t)}null==s||s.addEventListener("abort",f)}))}(0,{cleanupBeforeAbort:()=>clearTimeout(n),abortSignal:r,abortErrorMsg:null!=o?o:a})}var u=n(187),f=n.n(u);class h extends Error{constructor(t,e){super(t),this.name="SendMessageError",this.ackId=e.ackId,this.errorDetail=e.errorDetail}}const l="undefined"!=typeof process&&process.env&&process.env.DEBUG||void 0;let p,d=[],y=[];const g=[];l&&b(l);const w=Object.assign((t=>m(t)),{enable:b,enabled:_,disable:function(){const t=p||"";return b(""),t},log:function(...t){if(t.length>0){const e=String(t[0]);e.includes(":error")?console.error(...t):e.includes(":warning")?console.warn(...t):e.includes(":info")?console.info(...t):(e.includes(":verbose"),console.debug(...t))}}});function b(t){p=t,d=[],y=[];const e=/\\*/g,n=t.split(",").map((t=>t.trim().replace(e,".*?")));for(const t of n)t.startsWith("-")?y.push(new RegExp(`^${t.substr(1)}$`)):d.push(new RegExp(`^${t}$`));for(const t of g)t.enabled=_(t.namespace)}function _(t){if(t.endsWith("*"))return!0;for(const e of y)if(e.test(t))return!1;for(const e of d)if(e.test(t))return!0;return!1}function m(t){const e=Object.assign((function(...n){e.enabled&&(n.length>0&&(n[0]=`${t} ${n[0]}`),e.log(...n))}),{enabled:_(t),destroy:v,log:w.log,namespace:t,extend:E});return g.push(e),e}function v(){const t=g.indexOf(this);return t>=0&&(g.splice(t,1),!0)}function E(t){const e=m(`${this.namespace}:${t}`);return e.log=this.log,e}const I=w,R=new Set,A="undefined"!=typeof process&&process.env&&process.env.AZURE_LOG_LEVEL||void 0;let k;const O=I("azure");O.log=(...t)=>{I.log(...t)};const B=["verbose","info","warning","error"];A&&(L(A)?function(t){if(t&&!L(t))throw new Error(`Unknown log level \'${t}\'. Acceptable values: ${B.join(",")}`);k=t;const e=[];for(const t of R)T(t)&&e.push(t.namespace);I.enable(e.join(","))}(A):console.error(`AZURE_LOG_LEVEL set to unknown log level \'${A}\'; logging is not enabled. Acceptable values: ${B.join(", ")}.`));const S={verbose:400,info:300,warning:200,error:100};function C(t,e){e.log=(...e)=>{t.log(...e)}}function M(t,e){const n=Object.assign(t.extend(e),{level:e});if(C(t,n),T(n)){const t=I.disable();I.enable(t+","+n.namespace)}return R.add(n),n}function T(t){return Boolean(k&&S[t.level]<=S[k])}function L(t){return B.includes(t)}const U=function(t){const e=O.extend("web-pubsub-client");return C(O,e),{error:M(e,"error"),warning:M(e,"warning"),info:M(e,"info"),verbose:M(e,"verbose")}}();var x,j=n(764);function D(t,e){switch(e){case"text":if("string"!=typeof t)throw new TypeError("Message must be a string.");return t;case"json":return t;case"binary":case"protobuf":if(t instanceof ArrayBuffer)return j.lW.from(t).toString("base64");throw new TypeError("Message must be a ArrayBuffer")}}function $(t,e){if("text"===e){if("string"!=typeof t)throw new TypeError("Message must be a string when dataType is text");return t}if("json"===e)return t;if("binary"===e||"protobuf"===e){const e=j.lW.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}return null}class P{constructor(){this.isReliableSubProtocol=!0,this.name="json.reliable.webpubsub.azure.v1"}parseMessages(t){return function(t){if("string"!=typeof t)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!t)throw new Error("No input");const e=JSON.parse(t),n=e;let r;if("system"===n.type)if("connected"===n.event)r=Object.assign(Object.assign({},e),{kind:"connected"});else{if("disconnected"!==n.event)return null;r=Object.assign(Object.assign({},e),{kind:"disconnected"})}else if("message"===n.type)if("group"===n.from){const t=$(e.data,e.dataType);if(null===t)return null;r=Object.assign(Object.assign({},e),{data:t,kind:"groupData"})}else{if("server"!==n.from)return null;{const t=$(e.data,e.dataType);if(null===t)return null;r=Object.assign(Object.assign({},e),{data:t,kind:"serverData"})}}else{if("ack"!==n.type)return null;r=Object.assign(Object.assign({},e),{kind:"ack"})}return r}(t)}writeMessage(t){return function(t){let e;switch(t.kind){case"joinGroup":e={type:"joinGroup",group:t.group,ackId:t.ackId};break;case"leaveGroup":e={type:"leaveGroup",group:t.group,ackId:t.ackId};break;case"sendEvent":e={type:"event",event:t.event,ackId:t.ackId,dataType:t.dataType,data:D(t.data,t.dataType)};break;case"sendToGroup":e={type:"sendToGroup",group:t.group,ackId:t.ackId,dataType:t.dataType,data:D(t.data,t.dataType),noEcho:t.noEcho};break;case"sequenceAck":e={type:"sequenceAck",sequenceId:t.sequenceId};break;default:throw new Error(`Unsupported type: ${t.kind}`)}return JSON.stringify(e)}(t)}}class G{constructor(t,e){this._socket=new WebSocket(t,e),this._socket.binaryType="arraybuffer"}onopen(t){this._socket.onopen=t}onclose(t){this._socket.onclose=e=>t(e.code,e.reason)}onerror(t){this._socket.onerror=e=>t(e)}onmessage(t){this._socket.onmessage=e=>t(e.data)}close(t,e){this._socket.close(t,e)}send(t,e){return new Promise(((e,n)=>{try{this._socket.send(t),e()}catch(t){n(t)}}))}isOpen(){return this._socket.readyState===WebSocket.OPEN}}class N{create(t,e){return new G(t,e)}}!function(t){t.Stopped="Stopped",t.Disconnected="Disconnected",t.Connecting="Connecting",t.Connected="Connected",t.Recovering="Recovering"}(x||(x={}));class F{constructor(t){this._retryOptions=t,this._maxRetriesToGetMaxDelay=Math.ceil(Math.log2(this._retryOptions.maxRetryDelayInMs)-Math.log2(this._retryOptions.retryDelayInMs)+1)}nextRetryDelayInMs(t){return t>this._retryOptions.maxRetries?null:"Fixed"===this._retryOptions.mode?this._retryOptions.retryDelayInMs:this._calculateExponentialDelay(t)}_calculateExponentialDelay(t){return t>=this._maxRetriesToGetMaxDelay?this._retryOptions.maxRetryDelayInMs:(1<<t-1)*this._retryOptions.retryDelayInMs}}class q{constructor(t){this.isJoined=!1,this.name=t}}class W{constructor(t){this._promise=new Promise(((t,e)=>{this._resolve=t,this._reject=e})),this.ackId=t}promise(){return this._promise}resolve(t){this._resolve(t)}reject(t){this._reject(t)}}class z{constructor(){this._sequenceId=0,this._isUpdate=!1}tryUpdate(t){return this._isUpdate=!0,t>this._sequenceId&&(this._sequenceId=t,!0)}tryGetSequenceId(){return this._isUpdate?(this._isUpdate=!1,[!0,this._sequenceId]):[!1,null]}reset(){this._sequenceId=0,this._isUpdate=!1}}class J{constructor(t,e,n){this._func=t,this._abortController=new s,this._interval=e,this._obj=n,this._start()}abort(){try{this._abortController.abort()}catch(t){}}async _start(){const t=this._abortController.signal;for(;!t.aborted;)try{await this._func(this._obj)}catch(t){}finally{await c(this._interval)}}}window.wps={Client:class{constructor(t,e){this._emitter=new(f()),this._isStopping=!1,this._isInitialConnected=!1,this._credential="string"==typeof t?{getClientAccessUrl:t}:t,null==e&&(e={}),this._buildDefaultOptions(e),this._options=e,this._messageRetryPolicy=new F(this._options.messageRetryOptions),this._reconnectRetryPolicy=new F(this._options.reconnectRetryOptions),this._protocol=this._options.protocol,this._groupMap=new Map,this._ackMap=new Map,this._sequenceId=new z,this._state=x.Stopped,this._ackId=0}nextAckId(){return this._ackId=this._ackId+1,this._ackId}async start(t){if(this._isStopping)throw new Error("Can\'t start a client during stopping");if(this._state!==x.Stopped)throw new Error("Client can be only started when it\'s Stopped");let e;t&&(e=t.abortSignal);try{await this._startCore(e)}catch(t){throw this._changeState(x.Stopped),this._isStopping=!1,t}}async _startFromRestarting(t){if(this._state!==x.Disconnected)throw new Error("Client can be only restarted when it\'s Disconnected");try{U.verbose("Staring reconnecting."),await this._startCore(t)}catch(t){throw this._changeState(x.Disconnected),t}}async _startCore(t){if(this._changeState(x.Connecting),U.info("Staring a new connection"),this._sequenceId.reset(),this._isInitialConnected=!1,this._lastCloseEvent=void 0,this._lastDisconnectedMessage=void 0,this._connectionId=void 0,this._reconnectionToken=void 0,this._uri=void 0,"string"==typeof this._credential.getClientAccessUrl?this._uri=this._credential.getClientAccessUrl:this._uri=await this._credential.getClientAccessUrl({abortSignal:t}),"string"!=typeof this._uri)throw new Error("The clientAccessUrl must be a string but currently it\'s "+typeof this._uri);await this._connectCore(this._uri)}stop(){this._state===x.Stopped||this._isStopping||(this._isStopping=!0,this._wsClient&&this._wsClient.isOpen()?this._wsClient.close():this._isStopping=!1)}on(t,e){this._emitter.on(t,e)}off(t,e){this._emitter.removeListener(t,e)}_emitEvent(t,e){this._emitter.emit(t,e)}async sendEvent(t,e,n,r){return await this._operationExecuteWithRetry((()=>this._sendEventAttempt(t,e,n,r)),null==r?void 0:r.abortSignal)}async _sendEventAttempt(t,e,n,r){var o;if(null===(o=null==r?void 0:r.fireAndForget)||void 0===o||!o)return await this._sendMessageWithAckId((r=>({kind:"sendEvent",dataType:n,data:e,ackId:r,event:t})),null==r?void 0:r.ackId,null==r?void 0:r.abortSignal);const i={kind:"sendEvent",dataType:n,data:e,event:t};return await this._sendMessage(i,null==r?void 0:r.abortSignal),{}}async joinGroup(t,e){return await this._operationExecuteWithRetry((()=>this._joinGroupAttempt(t,e)),null==e?void 0:e.abortSignal)}async _joinGroupAttempt(t,e){const n=this._getOrAddGroup(t),r=await this._joinGroupCore(t,e);return n.isJoined=!0,r}async _joinGroupCore(t,e){return await this._sendMessageWithAckId((e=>({group:t,ackId:e,kind:"joinGroup"})),null==e?void 0:e.ackId,null==e?void 0:e.abortSignal)}async leaveGroup(t,e){return await this._operationExecuteWithRetry((()=>this._leaveGroupAttempt(t,e)),null==e?void 0:e.abortSignal)}async _leaveGroupAttempt(t,e){const n=this._getOrAddGroup(t),r=await this._sendMessageWithAckId((e=>({group:t,ackId:e,kind:"leaveGroup"})),null==e?void 0:e.ackId,null==e?void 0:e.abortSignal);return n.isJoined=!1,r}async sendToGroup(t,e,n,r){return await this._operationExecuteWithRetry((()=>this._sendToGroupAttempt(t,e,n,r)),null==r?void 0:r.abortSignal)}async _sendToGroupAttempt(t,e,n,r){var o,i;const s=null!==(o=null==r?void 0:r.fireAndForget)&&void 0!==o&&o,a=null!==(i=null==r?void 0:r.noEcho)&&void 0!==i&&i;if(!s)return await this._sendMessageWithAckId((r=>({kind:"sendToGroup",group:t,dataType:n,data:e,ackId:r,noEcho:a})),null==r?void 0:r.ackId,null==r?void 0:r.abortSignal);const c={kind:"sendToGroup",group:t,dataType:n,data:e,noEcho:a};return await this._sendMessage(c,null==r?void 0:r.abortSignal),{}}_getWebSocketClientFactory(){return new N}_connectCore(t){if(this._isStopping)throw new Error("Can\'t start a client during stopping");return new Promise(((e,n)=>{const r=this._wsClient=this._getWebSocketClientFactory().create(t,this._protocol.name);r.onopen((()=>{if(this._isStopping){try{r.close()}catch(t){}n(new Error("The client is stopped"))}U.verbose("WebSocket connection has opened"),this._changeState(x.Connected),this._protocol.isReliableSubProtocol&&(null!=this._sequenceAckTask&&this._sequenceAckTask.abort(),this._sequenceAckTask=new J((async()=>{const[t,e]=this._sequenceId.tryGetSequenceId();if(t){const t={kind:"sequenceAck",sequenceId:e};await this._sendMessage(t)}}),1e3)),e()})),r.onerror((t=>{null!=this._sequenceAckTask&&this._sequenceAckTask.abort(),n(new Error(t))})),r.onclose(((t,e)=>{this._state===x.Connected?(U.verbose("WebSocket closed after open"),null!=this._sequenceAckTask&&this._sequenceAckTask.abort(),U.info(`WebSocket connection closed. Code: ${t}, Reason: ${e}`),this._lastCloseEvent={code:t,reason:e},this._handleConnectionClose.call(this)):(U.verbose("WebSocket closed before open"),n(new Error(`Failed to start WebSocket: ${t}`)))})),r.onmessage((t=>{const e=t=>{if(this._ackMap.has(t.ackId)){const e=this._ackMap.get(t.ackId);this._ackMap.delete(t.ackId),t.success||t.error&&"Duplicate"===t.error.name?e.resolve({ackId:t.ackId,isDuplicated:!0}):e.reject(new h("Failed to send message.",{ackId:t.ackId,errorDetail:t.error}))}},n=async t=>{if(this._connectionId=t.connectionId,this._reconnectionToken=t.reconnectionToken,!this._isInitialConnected){if(this._isInitialConnected=!0,this._options.autoRejoinGroups){const t=[];this._groupMap.forEach((e=>{e.isJoined&&t.push((async()=>{try{await this._joinGroupCore(e.name)}catch(t){this._safeEmitRejoinGroupFailed(e.name,t)}})())}));try{await Promise.all(t)}catch(t){}}this._safeEmitConnected(t.connectionId,t.userId)}},r=t=>{this._lastDisconnectedMessage=t},o=t=>{(null==t.sequenceId||this._sequenceId.tryUpdate(t.sequenceId))&&this._safeEmitGroupMessage(t)},i=t=>{(null==t.sequenceId||this._sequenceId.tryUpdate(t.sequenceId))&&this._safeEmitServerMessage(t)};let s;try{let e;if(e=Array.isArray(t)?Buffer.concat(t):t,s=this._protocol.parseMessages(e),null===s)return}catch(t){throw U.warning("An error occurred while parsing the message from service",t),t}try{switch(s.kind){case"ack":e(s);break;case"connected":n(s);break;case"disconnected":r(s);break;case"groupData":o(s);break;case"serverData":i(s)}}catch(t){U.warning(`An error occurred while handling the message with kind: ${s.kind} from service`,t)}}))}))}async _handleConnectionCloseAndNoRecovery(){this._state=x.Disconnected,this._safeEmitDisconnected(this._connectionId,this._lastDisconnectedMessage),this._options.autoReconnect?await this._autoReconnect():await this._handleConnectionStopped()}async _autoReconnect(){let t=!1,e=0;try{for(;!this._isStopping;)try{await this._startFromRestarting(),t=!0;break}catch(t){U.warning("An attempt to reconnect connection failed.",t),e++;const n=this._reconnectRetryPolicy.nextRetryDelayInMs(e);if(null==n)break;try{U.verbose(`Delay time for reconnect attempt ${e}: ${n}`),await c(n)}catch(t){}}}finally{t||this._handleConnectionStopped()}}_handleConnectionStopped(){this._isStopping=!1,this._state=x.Stopped,this._safeEmitStopped()}async _sendMessage(t,e){const n=this._protocol.writeMessage(t);if(!this._wsClient||!this._wsClient.isOpen())throw new Error("The connection is not connected.");await this._wsClient.send(n,e)}async _sendMessageWithAckId(t,e,n){null==e&&(e=this.nextAckId());const r=t(e);this._ackMap.has(e)||this._ackMap.set(e,new W(e));const o=this._ackMap.get(e);try{await this._sendMessage(r,n)}catch(t){this._ackMap.delete(e);let n="";throw t instanceof Error&&(n=t.message),new h(n,{ackId:e})}if(n)try{return await async function(t,e){if(e.aborted)throw new i("The operation was aborted.");let n;const r=new Promise(((t,r)=>{n=()=>{r(new i("The operation was aborted."))},e.addEventListener("abort",n)}));try{return await Promise.race([t,r])}finally{e.removeEventListener("abort",n)}}(o.promise(),n)}catch(t){if(t instanceof Error&&"AbortError"===t.name)throw new h("Cancelled by abortSignal",{ackId:e});throw t}return await o.promise()}async _handleConnectionClose(){if(this._ackMap.forEach(((t,e)=>{this._ackMap.delete(e)&&t.reject(new h("Connection is disconnected before receive ack from the service",{ackId:t.ackId}))})),this._isStopping)return U.warning("The client is stopping state. Stop recovery."),void this._handleConnectionCloseAndNoRecovery();if(this._lastCloseEvent&&1008===this._lastCloseEvent.code)return U.warning("The websocket close with status code 1008. Stop recovery."),void this._handleConnectionCloseAndNoRecovery();if(!this._protocol.isReliableSubProtocol)return U.warning("The protocol is not reliable, recovery is not applicable"),void this._handleConnectionCloseAndNoRecovery();const t=this._buildRecoveryUri();if(!t)return U.warning("Connection id or reconnection token is not available"),void this._handleConnectionCloseAndNoRecovery();let e=!1;this._state=x.Recovering;const n=s.timeout(3e4);try{for(;!n.aborted||this._isStopping;)try{return await this._connectCore.call(this,t),void(e=!0)}catch(t){await c(1e3)}}finally{e||(U.warning("Recovery attempts failed more then 30 seconds or the client is stopping"),this._handleConnectionCloseAndNoRecovery())}}_safeEmitConnected(t,e){this._emitEvent("connected",{connectionId:t,userId:e})}_safeEmitDisconnected(t,e){this._emitEvent("disconnected",{connectionId:t,message:e})}_safeEmitGroupMessage(t){this._emitEvent("group-message",{message:t})}_safeEmitServerMessage(t){this._emitEvent("server-message",{message:t})}_safeEmitStopped(){this._emitEvent("stopped",{})}_safeEmitRejoinGroupFailed(t,e){this._emitEvent("rejoin-group-failed",{group:t,error:e})}_buildDefaultOptions(t){return null==t.autoReconnect&&(t.autoReconnect=!0),null==t.autoRejoinGroups&&(t.autoRejoinGroups=!0),null==t.protocol&&(t.protocol=new P),this._buildMessageRetryOptions(t),this._buildReconnectRetryOptions(t),t}_buildMessageRetryOptions(t){t.messageRetryOptions||(t.messageRetryOptions={}),(null==t.messageRetryOptions.maxRetries||t.messageRetryOptions.maxRetries<0)&&(t.messageRetryOptions.maxRetries=3),(null==t.messageRetryOptions.retryDelayInMs||t.messageRetryOptions.retryDelayInMs<0)&&(t.messageRetryOptions.retryDelayInMs=1e3),(null==t.messageRetryOptions.maxRetryDelayInMs||t.messageRetryOptions.maxRetryDelayInMs<0)&&(t.messageRetryOptions.maxRetryDelayInMs=3e4),null==t.messageRetryOptions.mode&&(t.messageRetryOptions.mode="Fixed")}_buildReconnectRetryOptions(t){t.reconnectRetryOptions||(t.reconnectRetryOptions={}),(null==t.reconnectRetryOptions.maxRetries||t.reconnectRetryOptions.maxRetries<0)&&(t.reconnectRetryOptions.maxRetries=Number.MAX_VALUE),(null==t.reconnectRetryOptions.retryDelayInMs||t.reconnectRetryOptions.retryDelayInMs<0)&&(t.reconnectRetryOptions.retryDelayInMs=1e3),(null==t.reconnectRetryOptions.maxRetryDelayInMs||t.reconnectRetryOptions.maxRetryDelayInMs<0)&&(t.reconnectRetryOptions.maxRetryDelayInMs=3e4),null==t.reconnectRetryOptions.mode&&(t.reconnectRetryOptions.mode="Fixed")}_buildRecoveryUri(){if(this._connectionId&&this._reconnectionToken&&this._uri){const t=new URL(this._uri);return t.searchParams.append("awps_connection_id",this._connectionId),t.searchParams.append("awps_reconnection_token",this._reconnectionToken),t.toString()}return null}_getOrAddGroup(t){return this._groupMap.has(t)||this._groupMap.set(t,new q(t)),this._groupMap.get(t)}_changeState(t){U.verbose(`The client state transfer from ${this._state.toString()} to ${t.toString()}`),this._state=t}async _operationExecuteWithRetry(t,e){let n=0;for(;;)try{return await t.call(this)}catch(t){n++;const r=this._messageRetryPolicy.nextRetryDelayInMs(n);if(null==r)throw t;if(await c(r),null==e?void 0:e.aborted)throw t}}}}})()})();';
        const script = document.createElement('script');
        script.innerHTML = e;
        document.head.appendChild(script);
    },
    InitJs__deps: [
        'options',
        'client',
        'negotiation',
        'ConvertObjectToPointer'
    ],
    InitJs: function (optionsStr, negotiateType, groupMessageReceivedCallback, connectedCallback, disconnectedCallback, stoppedCallback, rejoinGroupFailedCallback, updateNegotiation) {
        if (typeof UTF8ToString !== 'undefined')
            _options = JSON.parse(UTF8ToString(optionsStr));
        else
            _options = JSON.parse(optionsStr);
        const WebPubSubClient = window.wps.Client;
        _client = new WebPubSubClient({
            getClientAccessUrl: function (abortSignal) {
                const body = JSON.stringify({
                        NegotiateType: negotiateType,
                        RoomId: _options.RoomId
                    });
                const req = new XMLHttpRequest();
                req.open('POST', _options.NegotiateEndpoint, false);
                req.setRequestHeader('Content-Type', 'application/json');
                req.send(body);
                if (req.status === 200) {
                    _negotiation = JSON.parse(req.responseText);
                    const ptr = _ConvertObjectToPointer(_negotiation);
                    dynCall('vi', updateNegotiation, [ptr]);
                    return _negotiation.url;
                } else {
                    console.error('Failed to get negotiation', req);
                }
            }
        });
        _client.on('connected', function (e) {
            const ptr = _ConvertObjectToPointer(e);
            dynCall('vi', connectedCallback, [ptr]);
        });
        _client.on('group-message', function (e) {
            const ptr = _ConvertObjectToPointer(e);
            dynCall('vi', groupMessageReceivedCallback, [ptr]);
        });
        _client.on('disconnected', function (e) {
            const ptr = _ConvertObjectToPointer(e);
            dynCall('vi', disconnectedCallback, [ptr]);
        });
        _client.on('stopped', function (e) {
            dynCall('v', stoppedCallback);
        });
    },
    ConvertObjectToPointer: function (e) {
        const str = JSON.stringify(e);
        const bufferSize = lengthBytesUTF8(str) + 1;
        const buffer = _malloc(bufferSize);
        stringToUTF8(str, buffer, bufferSize);
        return buffer;
    },
    StartJs__deps: ['client'],
    StartJs: function () {
        _client.start().then(function () {
            console.log('connected to webpubsub');
        }).catch(function (err) {
            console.warn('Fail to start connection', err);
        });
    },
    StopJs__deps: ['client'],
    StopJs: function () {
        _client.stop();
    },
    SendEventJs__deps: ['client'],
    SendEventJs: function (channelPtr, contentPtr) {
        let content = contentPtr;
        let channel = channelPtr;
        if (typeof UTF8ToString !== 'undefined') {
            content = UTF8ToString(contentPtr);
            channel = UTF8ToString(channelPtr);
        }
        _client.sendToGroup(channel, content, 'text');
    }
});
